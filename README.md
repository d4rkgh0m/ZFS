# Практические навыки работы с ZFS
## Определить алгоритм с наилучшим сжатием:
## Определить какие алгоритмы сжатия поддерживает zfs (gzip, zle, lzjb, lz4);
## создать 4 файловых системы на каждой применить свой алгоритм сжатия;
## для сжатия использовать либо текстовый файл, либо группу файлов.
## Определить настройки пула.
## С помощью команды zfs import собрать pool ZFS.
## Командами zfs определить настройки:
   
## - размер хранилища;
    
## - тип pool;
    
## - значение recordsize;
   
## - какое сжатие используется;
   
## - какая контрольная сумма используется.

## Работа со снапшотами:
## скопировать файл из удаленной директории;
## восстановить файл локально. zfs receive;
## найти зашифрованное сообщение в файле secret_message.

## Создаем виртуальную машину
## Создаем Vagrantfile по предложенному шаблону
## Запускаем 
vagrant up
## после развертывания виртуальной машины и установки пакетов указанных в provision
## заходим на виртуалку
vagrant ssh
## Переходим в root пользователя: 
sudo -i
# ---------------------------------------------
# 1. Определение алгоритма с наилучшим сжатием
# ---------------------------------------------
## Смотрим список всех дисков, которые есть в виртуальной машине: 
lsblk
## Создаём пул из двух дисков в режиме RAID 1:
zpool create otus1 mirror /dev/sdb /dev/sdc
## Создадим ещё 3 пула:
zpool create otus2 mirror /dev/sdd /dev/sde
zpool create otus3 mirror /dev/sdf /dev/sdg
zpool create otus4 mirror /dev/sdh /dev/sdi
## Смотрим информацию о пулах:
zpool list
## Добавим разные алгоритмы сжатия в каждую файловую систему:
## Алгоритм lzjb:
zfs set compression=lzjb otus1
## Алгоритм lz4:
zfs set compression=lz4 otus2
## Алгоритм gzip: 
zfs set compression=gzip-9 otus3
## Алгоритм zle:  
zfs set compression=zle otus4
## Проверим, что все файловые системы имеют разные методы сжатия:
zfs get all | grep compression
## Скачаем один и тот же текстовый файл во все пулы:
for i in {1..4}; do wget -P /otus$i https://gutenberg.org/cache/epub/2600/pg2600.converter.log; done
## Проверим, что файл был скачан во все пулы:
ls -l /otus*
## Проверим, сколько места занимает один и тот же файл в разных пулах и проверим степень сжатия файлов:
zfs list
zfs get all | grep compressratio | grep -v ref
## Вывод команды
## otus1  compressratio         1.81x                  -
## otus2  compressratio         2.22x                  -
## otus3  compressratio         3.65x                  -
## otus4  compressratio         1.00x                  -
## Итак алгоритм gzip-9 самый эффективный по сжатию.
# -------------------------------
# 2. Определение настроек пула
# -------------------------------
